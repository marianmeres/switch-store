const e=e=>"function"==typeof e,t=(t,n="")=>{if(!e(t))throw new TypeError(`${n} Expecting function arg`.trim())},n=t=>e(t.subscribe),r=(n,r=null)=>{const s=t=>e(r?.persist)&&r.persist(t);let u=(()=>{const e=new Map,t=t=>(e.has(t)||e.set(t,new Set),e.get(t)),n=(e,n)=>{if("function"!=typeof n)throw new TypeError("Expecting callback function as second argument");return t(e).add(n),()=>t(e).delete(n)};return{publish:(e,n)=>{t(e).forEach((e=>e(n)))},subscribe:n,subscribeOnce:(e,t)=>{const r=n(e,(e=>{t(e),r()}));return r},unsubscribeAll:t=>e.delete(t)}})(),i=n;s(i);const c=()=>i,o=e=>{i!==e&&(i=e,s(i),u.publish("change",i))};return{set:o,get:c,update:e=>{t(e,"[update]"),o(e(c()))},subscribe:e=>(t(e,"[subscribe]"),e(i),u.subscribe("change",e))}},s=(s,u=null,i=null)=>{const c=e=>null==e?null:!!e,o=r({value:c(s),data:u},i),l=((s,u,i=null)=>{const c=t=>e(i?.persist)&&i.persist(t),o=r(i?.initialValue),l=[];if(s.forEach((e=>{if(!n(e))throw new TypeError("Expecting array of StoreLike objects");e.subscribe((e=>l.push(e)))()})),!e(u))throw new TypeError("Expecting second argument to be the derivative function");if(!u.length||u.length>2)throw new TypeError("Expecting the derivative function to have exactly 1 or 2 arguments");let a=0,b=[];return{get:o.get,subscribe:e=>{t(e,"[derived.subscribe]"),a++||s.forEach(((e,t)=>{b.push(e.subscribe((e=>{l[t]=e,1===u.length?(o.set(u(l)),c(o.get())):u(l,(e=>{o.set(e),c(o.get())}))})))}));const n=o.subscribe(e);return()=>{--a||(b.forEach((e=>e())),b=[]),n()}}}})([o],(([e])=>{const t=!0===e.value,n=null===e.value,r=!t;return{data:e.data,isOn:t,isOff:r,isUndefined:n,isOpen:t,isClosed:r}})),a=(e,t)=>{let n=o.get();void 0!==t&&(n={...n,data:t}),o.set({...n,value:c(e)})},b=e=>e.length>1?e[1]:e[0]&&(e[0]instanceof Event||["target","bubbles","cancelable","isTrusted"].every((t=>t in e[0])))?null:e[0],g=(...e)=>a(!0,b(e)),p=(...e)=>a(!1,b(e)),f=(...e)=>a(void 0,b(e));return{subscribe:l.subscribe,get:l.get,on:g,off:p,unset:f,toggle:()=>o.update((e=>({...e,value:c(!e.value)}))),toggleUnset:()=>o.get().value?f():g(),open:g,close:p}};export{s as createSwitchStore};
